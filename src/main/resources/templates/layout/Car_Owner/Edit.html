<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/2465434fef.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/css/fragment.css}">
    <link rel="stylesheet" th:href="@{/css/rating.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/AddCar.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/Edit.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/EditBasic.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/EditDetail.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/EditPricing.css}">

</head>
<div th:replace="fragments/fragment :: header"></div>
<section class="container-fluid">
    <ul class="breadcrumb">
        <li><a th:href="@{/}">Home</a></li>
        <li><a th:href="@{/car-owner/mycar}">My car</a></li>
        <li>Edit details</li>
    </ul>
    <p>Edit car details</p>
</section>
<div class="row mb-5 info" th:object="${car}">
    <div class="col-sm-7 mt-3">
        <input type="hidden" th:field="*{images}" class="images">
        <div id="slide" class="carousel slide" data-ride="carousel">

            <!-- Indicators -->
            <ul class="carousel-indicators">
                <li data-target="#slide" data-slide-to="0" class="active"></li>
                <li data-target="#slide" data-slide-to="1"></li>
                <li data-target="#slide" data-slide-to="2"></li>
                <li data-target="#slide" data-slide-to="3"></li>
            </ul>

            <div class="image-container">
                <!-- The slideshow -->
                <div class="carousel-inner"></div>
            </div>

            <!-- Left and right controls -->
            <a class="carousel-control-prev" href="#slide" data-slide="prev">
                <span><i class="fa-solid fa-angle-left"></i></span>
            </a>
            <a class="carousel-control-next" href="#slide" data-slide="next">
                <span><i class="fa-solid fa-angle-right"></i></span>
            </a>
        </div>
    </div>
    <div class="col-md-3 mt-3">
        <p class="car-name" th:text="*{name}"></p>
        <input type="hidden" id="carId" th:field="*{id}">
        <table>
            <tr>
                <td><p>Ratings:</p></td>
                <td>
                    <i th:data-star="${car.getRatingAvgStar()}"></i>
                    <div>
                        <small th:each="booking : ${car.bookings}"
                               th:if="${booking.feedback == null || booking.feedback.ratings == null}">(No ratings yet)</small>
                    </div>
                </td>
            </tr>
            <tr>
                <td><p>No. of rides:</p></td>
                <td class="num-of-ride"><p th:text="${numberOfRide}"></p></td>
            </tr>
            <tr>
                <td><p>Price:</p></td>
                <td><p class="show-price"></p></td>
                <input type="hidden" class="base-price" th:value="*{basePrice}">
            </tr>
            <tr>
                <td><p>Locations:</p></td>
                <td class="location"><p th:text="*{address}"></p></td>
            </tr>
            <tr>
                <td><p>Status:</p></td>
                <td>
                    <p class="status" th:if="*{carStatus.name()} == 'Booked'" th:text="*{carStatus.name()}"></p>
                        <select class="status-select form-control" id="status-select" th:field="*{carStatus}" th:unless="*{carStatus.name()} == 'Booked'">
                            <option th:value="Available" style="color: limegreen">Available</option>
                            <option th:value="Stopped" style="color: red">Stopped</option>
                        </select>
                </td>
            </tr>
        </table>
    </div>
    <div class="col-md-2 mt-3">
        <a href="#" class="btn btn-primary btn-deposit" th:if="${booking.status.name() == 'Pending_Deposit'}" th:data-id="${booking.id}">Confirm Deposit</a>
        <a href="#" class="btn btn-primary btn-payment" th:if="${booking.status.name() == 'Pending_Payment'}" th:data-id="${booking.id}">Confirm Payment</a>
    </div>
</div>
<div class="info-title-container">
    <span class="info-title btn">Basic information</span>
    <span class="info-title btn">Details</span>
    <span class="info-title btn">Pricing</span>
</div>
<div class="info-container">
    <form action="" th:object="${car}" method="post" enctype="multipart/form-data">
        <input type="hidden" class="car-status" th:field="*{carStatus}">
        <div class="frag">
            <div th:replace="fragments/Car_Owner/Edit_Basic :: editBasic"></div>
        </div>

        <div class="frag" style="display: none">
            <div th:replace="fragments/Car_Owner/Edit_Detail :: editDetail"></div>
        </div>

        <div class="frag" style="display: none">
            <div th:replace="fragments/Car_Owner/Edit_Pricing :: editPricing"></div>
        </div>
        <div class="button-container">
            <button type="button" class="btn btn-primary edit-btn">Edit</button>
            <a th:href="@{/car-owner/mycar/edit(carid=${car.id})}" class="btn btn-danger discard-btn" style="display: none">Discard</a>
            <button type="button" class="btn btn-primary save-btn" style="display: none">Save</button>
        </div>
    </form>
</div>
<div class="background" style="display:none"></div>
<div class="pop-up" style="display:none">
    <form th:action="@{/car-owner/mycar/edit}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" class="deposit-value" name="deposit">
        <input type="hidden" class="payment-value" name="payment">
        <p></p>
        <p></p>
        <button type="button" class="btn no-btn">No</button>
        <button type="submit" class="btn yes-btn">Yes</button>
    </form>
</div>
<script th:src="@{/js/Car_Owner/fragment.js}"></script>
<div th:replace="fragments/fragment :: footer"></div>
<script th:src="@{/js/Car_Owner/Edit.js}"></script>
</body>
</html>