<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/2465434fef.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/css/fragment.css}">
    <link rel="stylesheet" th:href="@{/css/rating.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/AddCar.css}">
    <link rel="stylesheet" th:href="@{/css/Car_Owner/ListCar.css}">
</head>
<body>
<div th:replace="fragments/fragment :: header"></div>
<section class="container-fluid">
    <ul class="breadcrumb">
        <li><a th:href="@{/}">Home</a></li>
        <li>My Cars</li>
    </ul>
    <p>List of Cars</p>
</section>
<div class="module">
    <a th:href="@{/car-owner/mycar/add}" class="btn btn-primary add-car">Add car</a>
    <form th:action="@{/car-owner/mycar}" class="filter-form" method="get">
        <select id="" class="form-control" name="sort">
            <option value="1" th:selected="${sort == 1}">Newest to Latest</option>
            <option value="2" th:selected="${sort == 2}">Latest to Newest</option>
            <option value="3" th:selected="${sort == 3}">Base price asc</option>
            <option value="4" th:selected="${sort == 4}">Base price desc</option>
        </select>
        <input type="number" name="number" class="form-control" th:value="${number}">
        <span>perpage</span>
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
</div>
    <div class="row mb-5 info" th:each="car, sts : ${cars.content}">
        <div class="col-sm-7 mt-3">
            <input type="hidden" th:value="${car.images}" class="images">
            <div th:id="'slide' + ${sts.index}" class="carousel slide" data-ride="carousel">

                <!-- Indicators -->
                <ul class="carousel-indicators">
                    <li th:data-target="'#slide' + ${sts.index}" data-slide-to="0" class="active"></li>
                    <li th:data-target="'#slide' + ${sts.index}" data-slide-to="1"></li>
                    <li th:data-target="'#slide' + ${sts.index}" data-slide-to="2"></li>
                    <li th:data-target="'#slide' + ${sts.index}" data-slide-to="3"></li>
                </ul>

                <div class="image-container">
                    <!-- The slideshow -->
                    <div class="carousel-inner"></div>
                </div>

                <!-- Left and right controls -->
                <a class="carousel-control-prev" th:href="'#slide' + ${sts.index}" data-slide="prev">
                    <span><i class="fa-solid fa-angle-left"></i></span>
                </a>
                <a class="carousel-control-next" th:href="'#slide' + ${sts.index}" data-slide="next">
                    <span><i class="fa-solid fa-angle-right"></i></span>
                </a>
            </div>
        </div>
        <div class="col-md-3 mt-3">
            <p class="car-name" th:text="${car.name}"></p>
            <table>
                <tr>
                    <td><p>Ratings:</p></td>
                    <td>
                        <i th:data-star="${car.getRatingAvgStar()}"></i>
                        <div>
                            <small th:each="booking : ${car.bookings}"
                                   th:if="${booking.feedback == null || booking.feedback.ratings == null}">(No ratings yet)</small>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><p>No. of rides:</p></td>
                    <td class="num-of-ride"><p th:text="${numberOfRides[sts.index]}"></p></td>
                </tr>
                <tr>
                    <td><p>Price:</p></td>
                    <td><p class="price"></p></td>
                    <input type="hidden" class="base-price" th:value="${car.basePrice}">
                </tr>
                <tr>
                    <td><p>Locations:</p></td>
                    <td class="location"><p th:text="${car.address}"></p></td>
                </tr>
                <tr>
                    <td><p>Status:</p></td>
                    <td><p class="status"></p></td>
                    <input type="hidden" th:value="${car.carStatus}" class="car-status">
                </tr>
            </table>
        </div>
        <div class="col-md-2 mt-3">
            <a th:href="@{/car-owner/mycar/edit(carid=${car.id})}" class="btn btn-primary detail">View details</a>
            <input type="hidden" class="car-index" th:if="${bookings[sts.index].status.name() == 'Pending_Payment'}" th:value="${sts.index}">
            <a href="#" class="btn btn-primary deposit" th:if="${bookings[sts.index].status.name() == 'Pending_Deposit'}" th:data-id="${bookings[sts.index].id}">Confirm Deposit</a>
            <a href="#" class="btn btn-primary payment" th:if="${bookings[sts.index].status.name() == 'Pending_Payment'}" th:data-id="${bookings[sts.index].id}">Confirm Payment</a>
        </div>
    </div>

<div class="page-control">
    <ul class="pagination">
        <li th:if="${cars.hasPrevious()}" class="page-item">
            <a class="page-link" th:href="@{/car-owner/mycar(page=${cars.getNumber()},number=${param.number},sort=${param.sort})}">Previous</a>
        </li>

        <th:block th:each="pageNum : ${pageNums}">

            <th:block th:if="${ pageNum == (cars.getNumber() + 1) }">
                <li class="page-item active">
                    <a class="page-link" th:href="@{/car-owner/mycar(page=${pageNum},number=${param.number},sort=${param.sort})}" th:text="${pageNum}"></a>
                </li>
            </th:block>

            <th:block th:if="${ pageNum != (cars.getNumber() + 1) }">
                <li class="page-item">
                    <a class="page-link" th:href="@{/car-owner/mycar(page=${pageNum},number=${param.number},sort=${param.sort})}" th:text="${pageNum}"></a>
                </li>
            </th:block>
        </th:block>

        <li th:if="${cars.hasNext()}" class="page-item">
            <a class="page-link" th:href="@{/car-owner/mycar(page=${cars.getNumber()}+2,number=${param.number},sort=${param.sort})}">Next</a>
        </li>
    </ul>
</div>
<div class="background" style="display:none"></div>
<div class="pop-up" style="display:none">
    <input type="hidden" class="display-input" value="">
    <input type="hidden" class="car-status-value" value="">
    <input type="hidden" class="deposit-value" value="">
    <input type="hidden" class="payment-value" value="">
    <p>Confirm deposit</p>
    <p>Please confirm that you have receive the deposit this booking.</p>
    <button type="button" class="btn no-btn">No</button>
    <button type="button" class="btn yes-btn">Yes</button>
</div>
<script th:src="@{/js/Car_Owner/CarList.js}"></script>
<script th:src="@{/js/Car_Owner/fragment.js}"></script>
<div th:replace="fragments/fragment :: footer"></div>
</body>
</html>